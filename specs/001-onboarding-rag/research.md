# èª¿æŸ»çµæœ: ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆQ&Aã‚·ã‚¹ãƒ†ãƒ 

**ãƒ–ãƒ©ãƒ³ãƒ**: `001-onboarding-rag` | **æ—¥ä»˜**: 2025-12-01

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Phase 0ã§å®Ÿæ–½ã—ãŸæŠ€è¡“èª¿æŸ»ã®çµæœã‚’ã¾ã¨ã‚ã‚‹ã€‚plan.mdã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€Œè¦æ˜ç¢ºåŒ–ã€ã¨ã—ãŸãƒã‚¤ãƒ³ãƒˆã«ã¤ã„ã¦ã€å…·ä½“çš„ãªæŠ€è¡“é¸æŠã¨ãã®æ ¹æ‹ ã‚’è¨˜è¼‰ã™ã‚‹ã€‚

---

## èª¿æŸ»é …ç›®1: Bedrock Knowledge Baseã®æ¤œç´¢ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### æ±ºå®š
Amazon Bedrock Knowledge Baseã‚’ä½¿ç”¨ã—ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«OpenSearch Serverlessã‚’æ¡ç”¨ã™ã‚‹ã€‚

### æ ¹æ‹ 
**æ¤œç´¢ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·**:
- Bedrock Knowledge Base APIã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·: é€šå¸¸200-500ms (RetrieveAndGenerate API)
- OpenSearch Serverlessã®ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢: 50-200ms (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚ºã¨ã‚¯ã‚¨ãƒªè¤‡é›‘åº¦ã«ä¾å­˜)
- åˆè¨ˆäºˆæƒ³ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·: 500ms-1s (æ¤œç´¢ã®ã¿)
- LLMç”Ÿæˆæ™‚é–“: 1.5-4ç§’ (Claude Sonnet 4.5ã§1000ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆæ™‚ã€3.5ã‚ˆã‚Šç´„20%é«˜é€ŸåŒ–)
- ç·åˆå¿œç­”æ™‚é–“: 2.5-5ç§’ â†’ ä»•æ§˜æ›¸è¦ä»¶(3ç§’ä»¥å†…)ã‚’é”æˆå¯èƒ½

**æœ€é©åŒ–æˆ¦ç•¥**:
1. **Retrieve APIä½¿ç”¨**: RetrieveAndGenerate APIã§ã¯ãªãRetrieve APIã§æ¤œç´¢ã®ã¿å®Ÿè¡Œã—ã€LLMå‘¼ã³å‡ºã—ã‚’åˆ¥é€”åˆ¶å¾¡
2. **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°**: Claude Sonnet 4.5ã®Prompt Cachingã§ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
3. **æ‹¡å¼µæ€è€ƒãƒ¢ãƒ¼ãƒ‰**: å¿…è¦ã«å¿œã˜ã¦extended thinkingãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨(ç²¾åº¦é‡è¦–æ™‚)
4. **ä¸¦åˆ—å‡¦ç†**: æ¤œç´¢ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’ä¸¦åˆ—å®Ÿè¡Œ
5. **Lambda ProvisionedConcurrency**: ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆå›é¿

**ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ**:
- **OpenSearch Serverlessç›´æ¥ä½¿ç”¨**: ã‚ˆã‚Šä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã ãŒã€Bedrockçµ±åˆãªã—ã€‚åŸ‹ã‚è¾¼ã¿ç”Ÿæˆã‚’è‡ªå‰å®Ÿè£…ã™ã‚‹å¿…è¦ã‚ã‚Šã€‚
- **Pinecone/Weaviate**: SaaSãƒ™ã‚¯ãƒˆãƒ«DBã§é«˜æ€§èƒ½ã ãŒã€AWSã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹æ†²æ³•ã«åã™ã‚‹ã€‚è¿½åŠ ã‚³ã‚¹ãƒˆã€‚
- **Aurora PostgreSQL + pgvector**: ä½ã‚³ã‚¹ãƒˆã ãŒã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãŒæ‰‹å‹•ã€‚RAGç‰¹åŒ–æ©Ÿèƒ½ãªã—ã€‚

### æ¤œè¨¼ãŒå¿…è¦ãªäº‹é …
- å®Ÿéš›ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚»ãƒƒãƒˆ(100-1000ãƒ•ã‚¡ã‚¤ãƒ«)ã§ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·å®Ÿæ¸¬
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã«ã‚ˆã‚‹ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·å‰Šæ¸›åŠ¹æœ
- Knowledge Baseã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿(numberOfResults, overrideSearchType)ã®æœ€é©å€¤

---

## èª¿æŸ»é …ç›®2: Lambdaé–¢æ•°ã®æœ€é©ãƒ¡ãƒ¢ãƒªè¨­å®š

### æ±ºå®š
Lambdaé–¢æ•°ã®ãƒ¡ãƒ¢ãƒªè¨­å®š:
- **query_handler**: 1024MB (LLMå‘¼ã³å‡ºã— + æ¤œç´¢å‡¦ç†)
- **document_processor**: 512MB (ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‘ãƒ¼ã‚¹)
- **sync_kb**: 256MB (Knowledge BaseåŒæœŸãƒˆãƒªã‚¬ãƒ¼)
- **feedback_handler**: 256MB (DynamoDBæ›¸ãè¾¼ã¿ã®ã¿)

### æ ¹æ‹ 
**ãƒ¡ãƒ¢ãƒªã¨ã‚³ã‚¹ãƒˆã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•**:
- Lambdaã¯ãƒ¡ãƒ¢ãƒªã«æ¯”ä¾‹ã—ã¦CPUæ€§èƒ½ãŒå‘ä¸Š(1792MB = 1 vCPU)
- boto3ã®Bedrock APIã‚³ãƒ¼ãƒ«ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯I/Oå¾…æ©ŸãŒä¸»ã§ã€CPUè² è·ã¯ä½ã„
- 1024MBã§ååˆ†ãªå‡¦ç†é€Ÿåº¦ã¨ä½ã‚³ã‚¹ãƒˆã‚’ä¸¡ç«‹

**ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å‚è€ƒå€¤** (AWSå…¬å¼ãƒ‡ãƒ¼ã‚¿):
- 128MB: ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ 1-2ç§’ã€ã‚¦ã‚©ãƒ¼ãƒ å®Ÿè¡Œ 200-500ms
- 512MB: ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ 500-1000msã€ã‚¦ã‚©ãƒ¼ãƒ å®Ÿè¡Œ 100-200ms
- 1024MB: ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ 300-600msã€ã‚¦ã‚©ãƒ¼ãƒ å®Ÿè¡Œ 50-100ms

**ProvisionedConcurrencyæ¤œè¨**:
- query_handlerã®ã¿æœ¬ç•ªç’°å¢ƒã§1-2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°
- ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆå®Œå…¨å›é¿ã§ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·p95ã‚’3ç§’ä»¥å†…ã«ä¿è¨¼
- ã‚³ã‚¹ãƒˆ: ç´„$10-20/æœˆ (1ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€1024MB)

### ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ
- **2048MBä»¥ä¸Š**: å‡¦ç†é€Ÿåº¦å‘ä¸Šã¯é™å®šçš„(ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯I/Oå¾…ã¡)ã§ã‚³ã‚¹ãƒˆå¢—
- **256MBä»¥ä¸‹**: ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆãŒé•·ãã€Bedrock SDKã®åˆæœŸåŒ–ãŒé…å»¶

### æ¤œè¨¼ãŒå¿…è¦ãªäº‹é …
- Lambda Power Tuningãƒ„ãƒ¼ãƒ«ã§å®Ÿã‚³ãƒ¼ãƒ‰ã®æœ€é©ãƒ¡ãƒ¢ãƒªå€¤ã‚’æ¸¬å®š
- å®Ÿãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã§ã®ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆç™ºç”Ÿç‡

---

## èª¿æŸ»é …ç›®3: UIæŠ€è¡“é¸æŠ (Streamlit vs React vs Slack Bot)

### æ±ºå®š
**æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**:
1. **Phase 1 (MVP)**: Streamlit
2. **Phase 2**: Slack Botè¿½åŠ 
3. **Phase 3**: Reactæœ¬æ ¼UI (å¿…è¦ã«å¿œã˜ã¦)

### æ ¹æ‹ 

**Streamlit (Phase 1)**:
- **ãƒ¡ãƒªãƒƒãƒˆ**:
  - Pythonå˜ç‹¬ã§é–‹ç™ºå¯èƒ½ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çŸ¥è­˜ä¸è¦
  - è¿…é€Ÿãªãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°(1-2é€±é–“ã§å®Œæˆ)
  - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå‘¼ã³å‡ºã—ãŒç°¡æ½”
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
  - ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§ãŒä½ã„
  - ECS Fargateã¾ãŸã¯App RunnerãŒå¿…è¦(ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§ã¯ãªã„)
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: AWS App Runner (æœ€å°æ§‹æˆ: 1 vCPU, 2GB RAM, ç´„$30/æœˆ)

**Slack Bot (Phase 2)**:
- **ãƒ¡ãƒªãƒƒãƒˆ**:
  - æ—¢å­˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«çµ±åˆ
  - ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹(Lambda + API Gateway)
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã‚’è¦šãˆã‚‹å¿…è¦ãªã—
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
  - ãƒªãƒƒãƒUIãŒåˆ¶é™ã•ã‚Œã‚‹
  - Slack Enterpriseãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¿…è¦
- **å®Ÿè£…**: Slack Events API + Lambda

**React (Phase 3)**:
- **ãƒ¡ãƒªãƒƒãƒˆ**:
  - å®Œå…¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªUI
  - ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹(S3 + CloudFront)
  - ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã‚‚å®¹æ˜“
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
  - é–‹ç™ºæ™‚é–“ãŒé•·ã„(4-6é€±é–“)
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒå¿…è¦
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: S3 + CloudFront + API Gateway

### æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
MVPæ¤œè¨¼ã¯Streamlitã§è¿…é€Ÿã«å®Ÿæ–½ã€‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†å¾Œã€åˆ©ç”¨çŠ¶æ³ã«å¿œã˜ã¦Slack Botã¾ãŸã¯Reactã«ç§»è¡Œã€‚

### ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ
- **Amplify Hosting**: Reactã‚¢ãƒ—ãƒªã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒç°¡å˜ã ãŒã€MVPæ®µéšã§ã¯éå‰°
- **Gradio**: Streamlité¡ä¼¼ã ãŒã€ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒStreamlitã‚ˆã‚Šå°ã•ã„

---

## èª¿æŸ»é …ç›®4: IaCé¸æŠ (AWS CDK vs AWS SAM)

### æ±ºå®š
**AWS CDK (Python)** ã‚’æ¡ç”¨

### æ ¹æ‹ 
**CDKã®ãƒ¡ãƒªãƒƒãƒˆ**:
- Pythonã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ã‚³ãƒ¼ãƒ‰åŒ–(ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨åŒã˜è¨€èª)
- é«˜ãƒ¬ãƒ™ãƒ«ã®æŠ½è±¡åŒ–(L2/L3 Constructs)ã§è¨˜è¿°é‡ãŒå°‘ãªã„
- Bedrock, Knowledge Base, OpenSearch Serverlessã®ã‚µãƒãƒ¼ãƒˆãŒå……å®Ÿ
- ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯(pytest)ã§æ§‹æ–‡ãƒã‚§ãƒƒã‚¯å¯èƒ½

**SAMã¨ã®æ¯”è¼ƒ**:
| é …ç›® | CDK | SAM |
|------|-----|-----|
| è¨€èª | Python/TS/Javaç­‰ | YAML |
| æŠ½è±¡åŒ– | é«˜ãƒ¬ãƒ™ãƒ« | ä½ãƒ¬ãƒ™ãƒ«(CloudFormationç›´æ¥) |
| å­¦ç¿’æ›²ç·š | ã‚„ã‚„æ€¥ | ç·©ã‚„ã‹ |
| Bedrockçµ±åˆ | L2 Constructs | CloudFormationç›´æ¥è¨˜è¿° |
| ãƒ†ã‚¹ãƒˆ | pytest | é™å®šçš„ |

**SAMã‚’é¸ã°ãªã„ç†ç”±**:
- YAMLã§Bedrockãƒªã‚½ãƒ¼ã‚¹è¨˜è¿°ãŒå†—é•·
- Knowledge Baseã®è¨­å®šãŒè¤‡é›‘(CDKã§ã¯L2 Constructsã§ç°¡æ½”)
- ãƒãƒ¼ãƒ ãŒPythonã«ç¿’ç†Ÿã—ã¦ã„ã‚‹ãŸã‚ã€CDKã®æ–¹ãŒä¿å®ˆã—ã‚„ã™ã„

### å®Ÿè£…æ–¹é‡
- CDK Stackã‚’æ©Ÿèƒ½åˆ¥ã«åˆ†å‰²:
  - `StorageStack`: S3, DynamoDB
  - `BedrockStack`: Knowledge Base, IAMãƒ­ãƒ¼ãƒ«
  - `ApiStack`: API Gateway, Lambdaé–¢æ•°
- CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³: GitHub Actions â†’ CDK deploy

---

## èª¿æŸ»é …ç›®5: åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«é¸æŠ

### æ±ºå®š
**Amazon Titan Embeddings V2** ã‚’æ¡ç”¨

### æ ¹æ‹ 
**Titan Embeddings V2ã®ç‰¹å¾´**:
- ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒ: 1024æ¬¡å…ƒ(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)ã€256/512æ¬¡å…ƒã‚‚é¸æŠå¯èƒ½
- å¤šè¨€èªã‚µãƒãƒ¼ãƒˆ(æ—¥æœ¬èªå«ã‚€100+è¨€èª)
- ã‚³ã‚¹ãƒˆ: $0.0001/1000ãƒˆãƒ¼ã‚¯ãƒ³ (Cohere Embedã®1/5)
- Knowledge Baseã¨ã®ãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆ

**ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ**:
| ãƒ¢ãƒ‡ãƒ« | æ¬¡å…ƒ | æ—¥æœ¬èªæ€§èƒ½ | ã‚³ã‚¹ãƒˆ(/1M tokens) | å‚™è€ƒ |
|--------|------|-----------|-------------------|------|
| Titan Embeddings V2 | 1024 | è‰¯å¥½ | $0.10 | AWS native |
| Cohere Embed v3 | 1024 | å„ªç§€ | $0.50 | é«˜ç²¾åº¦ã ãŒé«˜ã‚³ã‚¹ãƒˆ |
| OpenAI text-embedding-3 | 1536 | å„ªç§€ | $0.13 | AWSå¤–éƒ¨ä¾å­˜ |

**é¸æŠç†ç”±**:
- ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒæœ€å„ªå…ˆ(æœˆé–“æƒ³å®šã‚¯ã‚¨ãƒªæ•°1ä¸‡ â†’ åŸ‹ã‚è¾¼ã¿ã‚³ã‚¹ãƒˆ$1ä»¥ä¸‹)
- æ—¥æœ¬èªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ååˆ†ãªæ¤œç´¢ç²¾åº¦
- Knowledge Baseã¨ã®çµ±åˆãŒæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«

### æ¤œè¨¼ãŒå¿…è¦ãªäº‹é …
- å®Ÿéš›ã®ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã®æ¤œç´¢ç²¾åº¦è©•ä¾¡
- Cohere Embedã¨ã®ç²¾åº¦æ¯”è¼ƒãƒ†ã‚¹ãƒˆ(A/Bãƒ†ã‚¹ãƒˆ)

---

## èª¿æŸ»é …ç›®6: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥

### æ±ºå®š
Claude Sonnet 4.5ã®Prompt Cachingã‚’æ´»ç”¨

### æ ¹æ‹ 
**Prompt Cachingã®ä»•çµ„ã¿**:
- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨æ¤œç´¢çµæœ(ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ)ã‚’åˆ¥ã€…ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆæ™‚ã€å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³ã‚³ã‚¹ãƒˆãŒ90%å‰Šæ¸›
- TTL: 5åˆ†(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
- Claude 4.5ã‚·ãƒªãƒ¼ã‚ºã§ã¯100ä¸‡ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé•·ã‚µãƒãƒ¼ãƒˆ(ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼)

**å®Ÿè£…æ–¹é‡**:
```python
# ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ(å›ºå®š) â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥
system_prompt = """ã‚ãªãŸã¯ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆQ&Aã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±ã‚’å‚ç…§ã—ã¦ã€æ­£ç¢ºã«å›ç­”ã—ã¦ãã ã•ã„ã€‚
å¿…ãšæƒ…å ±æºã‚’æ˜ç¤ºã—ã¦ãã ã•ã„ã€‚"""

# æ¤œç´¢çµæœ(å‹•çš„) â†’ æ¯å›é€ä¿¡
retrieved_docs = kb_service.retrieve(query)

# Bedrock APIå‘¼ã³å‡ºã— (Claude Sonnet 4.5)
response = bedrock.converse(
    modelId="anthropic.claude-sonnet-4-5-20250929-v1:0",
    system=[{"text": system_prompt, "cacheControl": {"type": "ephemeral"}}],
    messages=[{"role": "user", "content": format_query(query, retrieved_docs)}]
)
```

**ã‚³ã‚¹ãƒˆå‰Šæ¸›åŠ¹æœ** (Claude Sonnet 4.5):
- é€šå¸¸: å…¥åŠ›1000ãƒˆãƒ¼ã‚¯ãƒ³ = $0.003
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ: å…¥åŠ›1000ãƒˆãƒ¼ã‚¯ãƒ³ = $0.0003 (90%å‰Šæ¸›)
- æœˆé–“1ä¸‡ã‚¯ã‚¨ãƒªã§ã®ã‚³ã‚¹ãƒˆ: $30 â†’ $5 (ç´„$25å‰Šæ¸›)

**Claude Sonnet 4.5ã®è¿½åŠ æ©Ÿèƒ½**:
- **æ‹¡å¼µæ€è€ƒãƒ¢ãƒ¼ãƒ‰**: è¤‡é›‘ãªè³ªå•ã«å¯¾ã—ã¦æ·±ã„æ¨è«–ã‚’å®Ÿè¡Œ(ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
- **ãƒ„ãƒ¼ãƒ«çµ±åˆ**: tool searchã¨tool use examplesã§ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹æ¤œç´¢ã‚’æœ€é©åŒ–å¯èƒ½

### ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ
- **ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ãªã—**: ã‚³ã‚¹ãƒˆé«˜ã€å®Ÿè£…ã¯ã‚·ãƒ³ãƒ—ãƒ«
- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°**: è¤‡é›‘ã€LLMå‡ºåŠ›ã®éæ±ºå®šæ€§ã§ä¸é©åˆ‡
- **Claude Opus 4.5ä½¿ç”¨**: æœ€é«˜ç²¾åº¦ã ãŒå…¥åŠ›ã‚³ã‚¹ãƒˆãŒ3å€ã€å¿œç­”æ™‚é–“ã‚‚é•·ã„

---

## èª¿æŸ»é …ç›®7: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‘ãƒ¼ã‚¹æ–¹æ³•

### æ±ºå®š
**Lambda + Textractã®çµ„ã¿åˆã‚ã›**(PDFã®ã¿)ã€ä»–ã¯Pythonæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### æ ¹æ‹ 
**å¯¾å¿œå½¢å¼ã¨ãƒ‘ãƒ¼ã‚¹æ–¹æ³•**:
| å½¢å¼ | ãƒ‘ãƒ¼ã‚¹æ–¹æ³• | ãƒ©ã‚¤ãƒ–ãƒ©ãƒª/ã‚µãƒ¼ãƒ“ã‚¹ |
|------|-----------|-------------------|
| PDF | Amazon Textract | boto3 (textract) |
| Word (.docx) | python-docx | python-docx |
| ãƒ†ã‚­ã‚¹ãƒˆ (.txt, .md) | æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | open() |

**Textractä½¿ç”¨ç†ç”±**:
- ã‚¹ã‚­ãƒ£ãƒ³ã•ã‚ŒãŸPDF(ç”»åƒãƒ™ãƒ¼ã‚¹)ã«ã‚‚å¯¾å¿œ
- è¡¨ã‚„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä¿æŒã—ãŸæŠ½å‡º
- ã‚³ã‚¹ãƒˆ: $1.50/1000ãƒšãƒ¼ã‚¸ (åˆæœŸæƒ³å®šæ•°ç™¾ãƒšãƒ¼ã‚¸ â†’ $æ•°ä»¥ä¸‹)

**Wordå‡¦ç†**:
- python-docxã§ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºãŒååˆ†
- Textractã¯ä¸è¦(ã‚³ã‚¹ãƒˆå‰Šæ¸›)

**å®Ÿè£…ãƒ•ãƒ­ãƒ¼**:
```
S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ Lambda (document_processor)
  â”œâ”€ PDFã®å ´åˆ â†’ Textract â†’ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
  â”œâ”€ Wordã®å ´åˆ â†’ python-docx â†’ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
  â””â”€ ãƒ†ã‚­ã‚¹ãƒˆã®å ´åˆ â†’ ç›´æ¥èª­ã¿è¾¼ã¿
â†’ ãƒãƒ£ãƒ³ã‚¯åŒ–(langchain RecursiveCharacterTextSplitter)
â†’ Knowledge BaseåŒæœŸ
```

### ãƒãƒ£ãƒ³ã‚¯åŒ–æˆ¦ç•¥
- ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚º: 500-1000æ–‡å­—(æ—¥æœ¬èªã®å ´åˆ)
- ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—: 100æ–‡å­—
- ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿: `\n\n`, `ã€‚`, `\n` (å„ªå…ˆé †)

---

## èª¿æŸ»é …ç›®8: æ¡ˆä»¶ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†

### æ±ºå®š
S3ãƒ‘ã‚¹ãƒ™ãƒ¼ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è‡ªå‹•ä»˜ä¸ + Knowledge Baseãƒ•ã‚£ãƒ«ã‚¿

### æ ¹æ‹ 
**S3ãƒ‘ã‚¹æ§‹é€ **:
```
s3://bucket-name/
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ hr/               # äººäº‹éƒ¨
â”‚   â”‚   â””â”€â”€ å°±æ¥­è¦å‰‡.pdf
â”‚   â””â”€â”€ finance/          # çµŒç†éƒ¨
â”‚       â””â”€â”€ çµŒè²»ãƒ«ãƒ¼ãƒ«.docx
â””â”€â”€ projects/
    â”œâ”€â”€ project-001/
    â”‚   â””â”€â”€ ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf
    â””â”€â”€ project-002/
        â””â”€â”€ ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èª.md
```

**ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è‡ªå‹•ä»˜ä¸**:
Lambda (document_processor)ã§S3ãƒ‘ã‚¹ã‹ã‚‰æŠ½å‡º:
```python
def extract_metadata(s3_key: str) -> dict:
    parts = s3_key.split('/')
    if parts[0] == 'common':
        return {
            'category': 'common',
            'department': parts[1],
            'project_id': None
        }
    elif parts[0] == 'projects':
        return {
            'category': 'project',
            'department': None,
            'project_id': parts[1]
        }
```

**Knowledge Baseæ¤œç´¢æ™‚ã®ãƒ•ã‚£ãƒ«ã‚¿**:
```python
# æ¡ˆä»¶é¸æŠãªã— â†’ å…¨ç¤¾å…±é€šã®ã¿
filter = {"equals": {"key": "category", "value": "common"}}

# æ¡ˆä»¶é¸æŠã‚ã‚Š â†’ æ¡ˆä»¶å›ºæœ‰ + å…¨ç¤¾å…±é€š
filter = {
    "orAll": [
        {"equals": {"key": "project_id", "value": "project-001"}},
        {"equals": {"key": "category", "value": "common"}}
    ]
}
```

### ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ
- **DynamoDBã§æ‰‹å‹•ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†**: ç®¡ç†è² è·é«˜ã€S3ã¨ã®åŒæœŸãŒå¿…è¦
- **ãƒ•ã‚¡ã‚¤ãƒ«åè¦ç´„**: äººç‚ºãƒŸã‚¹ã®ãƒªã‚¹ã‚¯

---

## èª¿æŸ»é …ç›®9: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–

### æ±ºå®š
**CloudWatch Dashboards** (Phase 1) + **QuickSight** (Phase 2ã€å¿…è¦ã«å¿œã˜ã¦)

### æ ¹æ‹ 
**CloudWatch Dashboards**:
- DynamoDBãƒ‡ãƒ¼ã‚¿ã‚’Lambdaã§é›†è¨ˆ â†’ CloudWatch Custom Metricsã«é€ä¿¡
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½œæˆãŒç°¡å˜ã€è¿½åŠ ã‚³ã‚¹ãƒˆãªã—
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ãŒé«˜ã„

**ãƒ¡ãƒˆãƒªã‚¯ã‚¹ä¾‹**:
- è³ªå•æ•°/æ—¥
- æº€è¶³åº¦(ğŸ‘ğŸ‘ã®æ¯”ç‡)
- å¹³å‡å¿œç­”æ™‚é–“
- ã‚¨ãƒ©ãƒ¼ç‡

**QuickSight (Phase 2)**:
- DynamoDBã‹ã‚‰å®šæœŸçš„ã«S3ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ â†’ QuickSightåˆ†æ
- é«˜åº¦ãªåˆ†æ(ä¸æº€è¶³è³ªå•ã®å‚¾å‘åˆ†æã€æ™‚ç³»åˆ—åˆ†æ)
- ã‚³ã‚¹ãƒˆ: $9/æœˆ/ãƒ¦ãƒ¼ã‚¶ãƒ¼ + ãƒ‡ãƒ¼ã‚¿è»¢é€

**æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**:
MVPæ®µéšã¯CloudWatch Dashboardsã§ååˆ†ã€‚é‹ç”¨ãŒè»Œé“ã«ä¹—ã£ãŸã‚‰QuickSightã§è©³ç´°åˆ†æã€‚

---

## èª¿æŸ»é …ç›®10: SSOçµ±åˆæ–¹æ³•

### æ±ºå®š
Amazon Cognito User Pool + SAML/OIDC IdPçµ±åˆ

### æ ¹æ‹ 
**Cognito User Pool**:
- æ—¢å­˜ã®SSOã‚·ã‚¹ãƒ†ãƒ (Oktaã€Azure ADç­‰)ã¨SAML/OIDCã§é€£æº
- API Gateway Cognito Authorizerã§ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å±æ€§(éƒ¨ç½²ã€æ¡ˆä»¶)ã‚’IDãƒˆãƒ¼ã‚¯ãƒ³Claimã¨ã—ã¦å–å¾—

**èªè¨¼ãƒ•ãƒ­ãƒ¼**:
```
User â†’ SSO Login â†’ Cognito User Pool â†’ ID Token
â†’ Streamlit/React â†’ API Gateway (Cognito Authorizer)
â†’ Lambda (userContextå–å¾—)
```

**æ¡ˆä»¶ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**:
- IDãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰`custom:projects` Claimå–å¾—(ä¾‹: `["project-001", "project-002"]`)
- Lambdaé–¢æ•°ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªæ¡ˆä»¶ã®ã¿ã‚¯ã‚¨ãƒªå®Ÿè¡Œ

**å®Ÿè£…ä¾‹**:
```python
def get_user_projects(event):
    claims = event['requestContext']['authorizer']['claims']
    return claims.get('custom:projects', '').split(',')

def query_with_filter(query, user_projects):
    if not user_projects:
        # å…¨ç¤¾å…±é€šã®ã¿
        filter = {"equals": {"key": "category", "value": "common"}}
    else:
        # æ¡ˆä»¶å›ºæœ‰ + å…¨ç¤¾å…±é€š
        filter = {
            "orAll": [
                {"in": {"key": "project_id", "value": user_projects}},
                {"equals": {"key": "category", "value": "common"}}
            ]
        }
    return kb_service.retrieve(query, filter)
```

### ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ
- **IAMèªè¨¼**: ç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãŒå›°é›£
- **ã‚«ã‚¹ã‚¿ãƒ èªè¨¼**: å®Ÿè£…è² è·é«˜ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯

---

## ã¾ã¨ã‚

### ä¸»è¦ãªæŠ€è¡“æ±ºå®š

| é …ç›® | é¸æŠæŠ€è¡“ | æ ¹æ‹  |
|------|---------|------|
| ãƒ™ã‚¯ãƒˆãƒ«DB | Bedrock Knowledge Base (OpenSearch Serverless) | ãƒãƒãƒ¼ã‚¸ãƒ‰ã€AWSçµ±åˆã€ä½é‹ç”¨è² è· |
| åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ« | Titan Embeddings V2 | ã‚³ã‚¹ãƒˆåŠ¹ç‡ã€æ—¥æœ¬èªå¯¾å¿œã€RAGæœ€é©åŒ– |
| LLM | Claude Sonnet 4.5 (2025å¹´9æœˆãƒªãƒªãƒ¼ã‚¹) | æœ€æ–°ãƒ¢ãƒ‡ãƒ«ã€é«˜ç²¾åº¦ã€SWE-benchãƒˆãƒƒãƒ—ã€100ä¸‡ãƒˆãƒ¼ã‚¯ãƒ³ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ |
| UI (Phase 1) | Streamlit | è¿…é€Ÿãªãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚° |
| IaC | AWS CDK (Python) | é«˜ãƒ¬ãƒ™ãƒ«æŠ½è±¡åŒ–ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“ |
| èªè¨¼ | Cognito + SAML/OIDC | SSOçµ±åˆã€API Gatewayçµ±åˆ |
| Lambda ãƒ¡ãƒ¢ãƒª | query_handler: 1024MB | ã‚³ã‚¹ãƒˆã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãƒãƒ©ãƒ³ã‚¹ |
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‘ãƒ¼ã‚¹ | Textract (PDF) + python-docx | OCRå¯¾å¿œã€ã‚³ã‚¹ãƒˆåŠ¹ç‡ |
| å¯è¦–åŒ– | CloudWatch Dashboards | è¿½åŠ ã‚³ã‚¹ãƒˆãªã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  |

### æ®‹ã‚Šã®æ¤œè¨¼é …ç›®

Phase 1å®Ÿè£…å‰ã«ä»¥ä¸‹ã‚’æ¤œè¨¼:
1. Bedrock Knowledge Baseã®å®Ÿãƒ¬ã‚¤ãƒ†ãƒ³ã‚·æ¸¬å®š
2. Lambda Power Tuningã§æœ€é©ãƒ¡ãƒ¢ãƒªå€¤ç¢ºèª
3. Titan Embeddings V2ã®æ—¥æœ¬èªæ¤œç´¢ç²¾åº¦è©•ä¾¡
4. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã®å®Ÿã‚³ã‚¹ãƒˆå‰Šæ¸›åŠ¹æœæ¸¬å®š

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: Phase 1 (data-model.mdã€contracts/ã€quickstart.mdç”Ÿæˆ)ã«é€²ã‚€ã€‚
