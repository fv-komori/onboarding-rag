# 機能仕様: 社内ドキュメントQ&Aシステム

**機能ブランチ**: `001-onboarding-rag`
**作成日**: 2025-12-01
**ステータス**: ドラフト
**入力**: ユーザー説明: "新入社員向けのオンボーディング支援のRAGシステムを作りたい。
- 内容
    - 「経費精算どうやるの?」「◯◯ さんってどんな人?」みたいな質問に自動で回答
    - まずは就業規則など、社内ポータルに記載されている情報を取り込む
        - 案件ごとのルールやマニュアル、ユビキタス言語などもあれば取り込みたい。
        - 情報源(あれば、どのドキュメントの何ページか)も一緒に表示
    - フィードバック機能で継続的に改善する。
    - 新入社員だけじゃなく、案件異動した人だったりにも使えるので社内ドキュメントの方が近いかも。"

## Clarifications

### Session 2025-12-01

- Q: ユーザー認証とアクセス制御 → A: 既存のSSOシステムと統合してアクセス制御
- Q: ドキュメントの取り込み方法 → A: 管理者が定期的に手動でドキュメントをアップロード
- Q: 案件情報とユーザーの紐付け → A: ユーザーが質問時に対象案件を任意で選択（未選択の場合は全社共通情報のみ検索）
- Q: 対応するドキュメント形式 → A: PDF、Word、テキストファイル
- Q: 管理者機能の範囲 → A: フィードバックと質問履歴をデータベースに保存し、ダッシュボードツール（CloudWatch/QuickSight等）で可視化。システム内の管理者UI機能は不要

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー1 - 基本的な質問応答 (優先度: P1)

新入社員や案件異動者が、社内ルールや手続きについて質問すると、関連する情報と出典が即座に表示される。

**なぜこの優先度か**: これがシステムの核心的価値。ユーザーが自己解決できることで、質問のために他の社員の時間を奪わず、即座に疑問を解消できる。

**独立したテスト方法**: 質問入力と回答表示機能だけで完全にテストでき、社内情報への即時アクセスという価値を提供する。

**受け入れ条件**:

1. **前提** ユーザーがSSOで認証済み、**操作** システムにアクセスする、**期待** 質問入力画面が表示される
2. **前提** ユーザーがシステムにアクセスしている、**操作** 「経費精算の方法は?」と質問を入力する、**期待** 経費精算の手順が表示され、参照元(ドキュメント名とページ番号)が明示される
3. **前提** 社内ポータルの情報が取り込まれている、**操作** 「有給休暇の申請方法は?」と質問する、**期待** 関連する就業規則の該当箇所が引用され、出典情報が表示される
4. **前提** 複数の関連情報が存在する、**操作** 「新規プロジェクト立ち上げの手順は?」と質問する、**期待** 最も関連性の高い情報から順に表示され、それぞれに出典が付記される
5. **前提** ユーザーが質問を入力した、**操作** 回答を確認する、**期待** 回答時間が3秒以内である

---

### ユーザーストーリー2 - 案件固有情報の検索 (優先度: P2)

案件異動者が、配属された案件のルール、マニュアル、ユビキタス言語について質問すると、その案件固有の情報が表示される。

**なぜこの優先度か**: 新入社員向けの基本機能(P1)が動作すれば、同じ仕組みで案件固有情報も扱える。案件異動時のキャッチアップ時間を大幅に短縮できる。

**独立したテスト方法**: 案件固有のドキュメントを取り込み、案件関連の質問に対して適切な回答が返ることで独立してテスト可能。

**受け入れ条件**:

1. **前提** 案件Aのマニュアルが取り込まれている、**操作** 案件Aを選択して「デプロイ手順は?」と質問する、**期待** 案件A固有のデプロイ手順が、該当マニュアルの参照情報とともに表示される
2. **前提** 複数案件のドキュメントが存在する、**操作** 案件Bを選択して「『顧客』の定義は?」と質問する、**期待** 案件Bのユビキタス言語定義が表示される
3. **前提** 案件固有情報と全社共通情報が混在する、**操作** 案件を選択して質問する、**期待** 案件固有情報が優先的に表示されつつ、関連する全社情報も参照できる
4. **前提** ユーザーが質問画面にいる、**操作** 案件を選択せずに「経費精算の方法は?」と質問する、**期待** 全社共通の経費精算情報のみが表示される

---

### ユーザーストーリー3 - フィードバックによる改善 (優先度: P3)

ユーザーが回答の品質を評価し、コメントを残すことで、システムが継続的に改善される。

**なぜこの優先度か**: 基本的な質問応答(P1、P2)が機能すれば最低限の価値を提供できる。フィードバック機能は運用開始後の品質向上のために重要だが、初期リリースには必須ではない。

**独立したテスト方法**: フィードバック送信と記録機能だけで独立してテスト可能。

**受け入れ条件**:

1. **前提** ユーザーが回答を受け取った、**操作** 「役に立った」「役に立たなかった」のフィードバックを送信する、**期待** フィードバックが記録され、確認メッセージが表示される
2. **前提** フィードバックボタンを押した、**操作** 任意でコメントを入力できる、**期待** コメントがフィードバックとともに保存される
3. **前提** 過去に同じ質問に複数のフィードバックがある、**操作** 質問をする、**期待** より評価の高かった回答パターンが優先的に表示される
4. **前提** フィードバックデータがデータベースに保存されている、**操作** ダッシュボードツールでデータを確認する、**期待** どの質問への回答が不十分かを特定できる

---

### エッジケース

- 質問に該当する情報がドキュメントに存在しない場合、どのように応答するか?
- 同じ質問に対して矛盾する情報が複数のドキュメントに存在する場合、どう処理するか?
- ドキュメントが更新された際、古い情報と新しい情報の整合性をどう保つか?
- 人名などの個人情報を含む質問に対して、プライバシー保護をどう実現するか?
- 極端に長い質問文や曖昧な質問に対して、どう対処するか?
- 大量の同時アクセスがあった場合、応答時間をどう維持するか?

## 要件 *(必須)*

### 機能要件

- **FR-001**: ユーザーが既存のSSOシステムを通じて認証され、システムにアクセスできること
- **FR-002**: ユーザーが自然言語で質問を入力できること
- **FR-002a**: ユーザーが質問時に対象案件を任意で選択できること
- **FR-003**: 案件が選択されていない場合、全社共通情報のみを検索対象とすること
- **FR-003a**: 案件が選択されている場合、その案件固有情報を優先しつつ、全社共通情報も検索対象とすること
- **FR-003b**: システムが社内ドキュメント(就業規則、社内ポータル情報等)から関連情報を検索し、回答として表示できること
- **FR-004**: 回答に情報源(ドキュメント名、ページ番号等)を明示できること
- **FR-005**: 案件固有のルール、マニュアル、ユビキタス言語などの情報を取り込めること
- **FR-006**: ユーザーが回答に対してフィードバック(役に立った/立たなかった)を送信できること
- **FR-007**: フィードバックに任意でコメントを追加できること
- **FR-008**: フィードバックデータをデータベースに記録すること
- **FR-009**: 質問履歴をデータベースに保存すること
- **FR-010**: 保存されたフィードバックと質問履歴を外部ダッシュボードツールで可視化できる形式で提供すること
- **FR-012**: 該当する情報が見つからない場合、その旨をユーザーに通知できること
- **FR-013**: 複数の関連情報がある場合、関連度順に表示できること

### 主要なデータ *(機能がデータを扱う場合に記載)*

- **質問データ**: ユーザーが入力した質問文、質問日時、質問者(オプション)
- **ドキュメントデータ**: ドキュメント名、ファイル形式(PDF/Word/テキスト)、内容、ページ番号(該当する場合)、カテゴリ(全社共通/案件固有)、最終更新日
- **回答データ**: 質問に対する回答テキスト、参照元ドキュメント情報、生成日時
- **フィードバックデータ**: 質問ID、評価(役に立った/立たなかった)、コメント(オプション)、フィードバック日時
- **案件情報**: 案件名、案件固有ドキュメントへの紐付け

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーが質問を入力してから回答を受け取るまで3秒以内で完了する
- **SC-002**: よくある質問(経費精算、休暇申請等)に対して、80%以上の精度で適切な回答を提供できる
- **SC-003**: 回答の70%以上が「役に立った」とフィードバックされる
- **SC-004**: 新入社員や案件異動者からの社内手続きに関する問い合わせが、導入前と比較して50%削減される
- **SC-005**: 100人の同時ユーザーでも応答時間が3秒以内を維持できる
- **SC-006**: 全ての回答に情報源が明記され、ユーザーが元のドキュメントを確認できる
- **SC-007**: フィードバックデータと質問履歴がダッシュボードで可視化され、管理者が回答品質の傾向を把握できる
